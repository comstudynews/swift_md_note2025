## **ğŸš€ Herokuì— Firebase Functions ëŒ€ì‹  Node.js API êµ¬ì¶• ë° ë°°í¬í•˜ëŠ” ë°©ë²•**

SwiftUI ì•±ì—ì„œ **Herokuì— ë°°í¬ëœ APIë¥¼ ì‚¬ìš©í•˜ì—¬ ìˆ˜ë¹„í•™ ë¶„ì„(Numerology Analysis) ê¸°ëŠ¥ì„ êµ¬í˜„**í•˜ê¸° ìœ„í•´ **Node.js + Express ê¸°ë°˜ APIë¥¼ Herokuì— ë°°í¬í•˜ëŠ” ë°©ë²•**ì„ ë‹¨ê³„ë³„ë¡œ ì„¤ëª…í•˜ê² ìŠµë‹ˆë‹¤.

---

## **ğŸ“Œ 1. Herokuì— Node.js API ì„œë²„ êµ¬ì¶•**
### **âœ… 1-1. Heroku ê³„ì • ìƒì„± ë° Heroku CLI ì„¤ì¹˜**
1. **[Heroku ê³µì‹ ì‚¬ì´íŠ¸](https://signup.heroku.com/)**ì—ì„œ ê³„ì • ìƒì„±  
2. **Heroku CLI ì„¤ì¹˜**  
   - **Mac**  
     ```bash
     brew tap heroku/brew && brew install heroku
     ```
   - **Windows**  
     [Heroku CLI ë‹¤ìš´ë¡œë“œ](https://devcenter.heroku.com/articles/heroku-cli) í›„ ì„¤ì¹˜  
3. **Heroku ë¡œê·¸ì¸ (í„°ë¯¸ë„ì—ì„œ ì‹¤í–‰)**
   ```bash
   heroku login
   ```

---

## **ğŸ“Œ 2. Node.js Express API ì„œë²„ ë§Œë“¤ê¸°**
### **âœ… 2-1. Node.js í”„ë¡œì íŠ¸ ì´ˆê¸°í™”**
```bash
mkdir numerology-api
cd numerology-api
npm init -y
```
âœ… **`npm init -y` ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ë©´ `package.json` íŒŒì¼ì´ ìë™ ìƒì„±ë¨**

---

### **âœ… 2-2. Express ë° CORS ì„¤ì¹˜**
```bash
npm install express cors dotenv
```
âœ… **Express (ì›¹ ì„œë²„), CORS (Cross-Origin Resource Sharing), dotenv (í™˜ê²½ ë³€ìˆ˜ ê´€ë¦¬) ì„¤ì¹˜**

---

### **âœ… 2-3. `server.js` ì‘ì„± (ìš´ì„¸ ë¶„ì„ API êµ¬í˜„)**
**`server.js` íŒŒì¼ì„ ìƒì„±í•˜ê³  ì•„ë˜ ì½”ë“œë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.**
```javascript
require("dotenv").config();
const express = require("express");
const cors = require("cors");

const app = express();
app.use(cors());
app.use(express.json());

// ğŸš€ ìˆ˜ë¹„í•™ ê³„ì‚° í•¨ìˆ˜ (ë‹¨ìˆœ ì˜ˆì œ)
function calculateNumerology(name, birthdate) {
    const numericBirthdate = birthdate.replace(/-/g, "").split("").reduce((a, b) => a + parseInt(b), 0);
    const luckyNumber = (name.length + numericBirthdate) % 9 + 1;
    return `${name}ë‹˜ì˜ í–‰ìš´ì˜ ìˆ«ìëŠ” ${luckyNumber}ì…ë‹ˆë‹¤.`;
}

// ğŸ¯ API ì—”ë“œí¬ì¸íŠ¸: Numerology ë¶„ì„
app.get("/numerology", (req, res) => {
    const { name, birthdate } = req.query;
    if (!name || !birthdate) {
        return res.status(400).json({ error: "ì´ë¦„ê³¼ ìƒë…„ì›”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”." });
    }

    const result = calculateNumerology(name, birthdate);
    res.json({ result });
});

// í¬íŠ¸ ì„¤ì •
const PORT = process.env.PORT || 5000;
app.listen(PORT, () => console.log(`ğŸš€ Numerology API Server running on port ${PORT}`));
```

âœ… **ì´ë¦„ê³¼ ìƒë…„ì›”ì¼ì„ ì…ë ¥í•˜ë©´ ìš´ì„¸ ë¶„ì„ ê²°ê³¼ ì œê³µ**  
âœ… **Herokuì— ë°°í¬ í›„ SwiftUI ì•±ì—ì„œ í˜¸ì¶œ ê°€ëŠ¥**  

---

## **ğŸ“Œ 3. Herokuì— API ë°°í¬**
### **âœ… 3-1. Heroku ì•± ìƒì„±**
```bash
heroku create numerology-api
```
âœ… **Herokuì—ì„œ ìƒˆë¡œìš´ ì•±(`numerology-api`) ìƒì„±**

---

### **âœ… 3-2. í”„ë¡œì íŠ¸ë¥¼ Gitìœ¼ë¡œ ì´ˆê¸°í™”**
```bash
git init
git add .
git commit -m "Initial commit"
```
âœ… **Gitì„ ì´ˆê¸°í™”í•˜ê³  API ì½”ë“œë¥¼ ì»¤ë°‹**

---

### **âœ… 3-3. Herokuì— í”„ë¡œì íŠ¸ í‘¸ì‹œ**
```bash
heroku git:remote -a numerology-api
git push heroku main
```
âœ… **Herokuì— API ì½”ë“œ ë°°í¬ ì™„ë£Œ**

---

### **âœ… 3-4. Herokuì—ì„œ API ì‹¤í–‰ í™•ì¸**
```bash
heroku open
```
âœ… **Herokuì—ì„œ APIê°€ ì‹¤í–‰ë˜ë©´ ë¸Œë¼ìš°ì €ì—ì„œ ì§ì ‘ APIë¥¼ í™•ì¸ ê°€ëŠ¥**  
âœ… **ì˜ˆì œ: `https://numerology-api.herokuapp.com/numerology?name=Kim&birthdate=1975-03-07`**  

---

## **ğŸ“Œ 4. SwiftUIì—ì„œ Heroku API ì—°ë™**
Heroku APIë¥¼ SwiftUI ì•±ì—ì„œ í˜¸ì¶œí•˜ì—¬ ë¶„ì„ ê²°ê³¼ë¥¼ í‘œì‹œí•˜ë„ë¡ ì½”ë“œë¥¼ ìˆ˜ì •í•©ë‹ˆë‹¤.

```swift
import SwiftUI

struct NumerologyView: View {
    @State private var name: String = ""
    @State private var birthdate = Date()
    @State private var bloodType: String = "A"
    let bloodTypes = ["A", "B", "O", "AB"]
    @State private var analysisResult: String = "ìš´ì„¸ ë¶„ì„ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤."
    @State private var isLoading: Bool = false

    var body: some View {
        NavigationView {
            Form {
                Section(header: Text("ê°œì¸ ì •ë³´ ì…ë ¥")) {
                    TextField("ì´ë¦„", text: $name)
                        .textFieldStyle(RoundedBorderTextFieldStyle())
                    
                    DatePicker("ìƒë…„ì›”ì¼", selection: $birthdate, displayedComponents: .date)
                    
                    Picker("í˜ˆì•¡í˜•", selection: $bloodType) {
                        ForEach(bloodTypes, id: \.self) { Text($0) }
                    }
                }
                
                Section {
                    Button(action: fetchNumerologyAnalysis) {
                        if isLoading {
                            ProgressView()
                        } else {
                            Text("ìš´ì„¸ ë¶„ì„í•˜ê¸°")
                                .frame(maxWidth: .infinity)
                                .padding()
                                .background(Color.blue)
                                .foregroundColor(.white)
                                .cornerRadius(10)
                        }
                    }
                }
                
                Section(header: Text("ìš´ì„¸ ë¶„ì„ ê²°ê³¼")) {
                    Text(analysisResult)
                        .padding()
                }
            }
            .navigationTitle("ìš´ì„¸ ë¶„ì„")
        }
    }
    
    func fetchNumerologyAnalysis() {
        isLoading = true
        let dateFormatter = DateFormatter()
        dateFormatter.dateFormat = "yyyy-MM-dd"
        let birthdateStr = dateFormatter.string(from: birthdate)
        
        let urlString = "https://numerology-api.herokuapp.com/numerology?name=\(name)&birthdate=\(birthdateStr)"
        
        guard let url = URL(string: urlString) else { return }

        URLSession.shared.dataTask(with: url) { data, _, error in
            DispatchQueue.main.async {
                isLoading = false
                if let data = data {
                    if let json = try? JSONSerialization.jsonObject(with: data, options: []) as? [String: Any],
                       let fortune = json["result"] as? String {
                        analysisResult = fortune
                    } else {
                        analysisResult = "ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."
                    }
                } else if let error = error {
                    analysisResult = "ì˜¤ë¥˜ ë°œìƒ: \(error.localizedDescription)"
                }
            }
        }.resume()
    }
}
```
âœ… **SwiftUIì—ì„œ Heroku API í˜¸ì¶œ ê°€ëŠ¥**  
âœ… **ìš´ì„¸ ë¶„ì„ ê²°ê³¼ë¥¼ JSON í˜•ì‹ìœ¼ë¡œ ê°€ì ¸ì™€ì„œ í‘œì‹œ**  

---

## **ğŸ“Œ 5. Heroku API í™•ì¥ ê¸°ëŠ¥**
### **âœ… Firestore ì—°ë™í•˜ì—¬ ì‚¬ìš©ì ìš´ì„¸ ë°ì´í„° ì €ì¥**
1. Firebase Admin SDK ì¶”ê°€
```bash
npm install firebase-admin
```
2. Firestore ì €ì¥ ê¸°ëŠ¥ ì¶”ê°€ (Heroku API ì½”ë“œ ìˆ˜ì •)
```javascript
const admin = require("firebase-admin");
admin.initializeApp();
const db = admin.firestore();

app.get("/numerology", async (req, res) => {
    const { name, birthdate } = req.query;
    if (!name || !birthdate) {
        return res.status(400).json({ error: "ì´ë¦„ê³¼ ìƒë…„ì›”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”." });
    }

    const result = calculateNumerology(name, birthdate);
    
    // Firestore ì €ì¥
    await db.collection("numerology_results").doc(name).set({
        name,
        birthdate,
        result,
        timestamp: admin.firestore.Timestamp.now()
    });

    res.json({ result });
});
```
âœ… **ìš´ì„¸ ë¶„ì„ ê²°ê³¼ë¥¼ Firestoreì— ìë™ ì €ì¥**  

---

## **ğŸ“Œ ê²°ë¡ **
ğŸ”¥ **Herokuì— Node.js APIë¥¼ ë°°í¬í•˜ì—¬ SwiftUIì—ì„œ ìš´ì„¸ ë¶„ì„ ê¸°ëŠ¥ êµ¬í˜„**  
ğŸ”¥ **Firestoreë¥¼ ì—°ë™í•˜ì—¬ ì‚¬ìš©ì ìš´ì„¸ ê¸°ë¡ ì €ì¥ ê°€ëŠ¥**  
ğŸ”¥ **HerokuëŠ” Firebase Functionsë³´ë‹¤ ë¹ ë¥¸ ì‘ë‹µ ì†ë„ë¥¼ ì œê³µí•˜ì§€ë§Œ ìœ ì§€ ê´€ë¦¬ í•„ìš”**  

ğŸš€ **ë‹¤ìŒ ë‹¨ê³„:**  
1ï¸âƒ£ **Firestore ì—°ë™í•˜ì—¬ ìš´ì„¸ ê¸°ë¡ ì¡°íšŒ ê¸°ëŠ¥ ì¶”ê°€**  
2ï¸âƒ£ **ì˜¤ëŠ˜ì˜ ìš´ì„¸ API êµ¬í˜„**  
3ï¸âƒ£ **SwiftUIì—ì„œ ì‚¬ìš©ì ê¸°ë¡ ì¡°íšŒ í™”ë©´ ì¶”ê°€**  

ğŸ“Œ **ì¶”ê°€ë¡œ í•„ìš”í•œ ê¸°ëŠ¥ì´ ìˆìœ¼ë©´ ë§ì”€í•´ì£¼ì„¸ìš”!** ğŸ˜ŠğŸ”¥


# ê³„ì • ì¸ì¦ (ì‹ ìš©ì¹´ë“œ ì •ë³´ ë“±ë¡)
### **ğŸš€ Herokuì—ì„œ "To create an app, verify your account" ì˜¤ë¥˜ í•´ê²° ë°©ë²•**

Herokuì—ì„œ `heroku create numerology-api` ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•  ë•Œ **"To create an app, verify your account by adding payment information."** ì˜¤ë¥˜ê°€ ë°œìƒí•˜ëŠ” ì´ìœ ëŠ” **Herokuê°€ ë¬´ë£Œ í”Œëœ(Spark Plan)ì—ì„œ ì‹ ê·œ ì•± ìƒì„±ì„ ì œí•œí–ˆê¸° ë•Œë¬¸**ì…ë‹ˆë‹¤.  
ğŸ‘‰ **í•´ê²° ë°©ë²•: Heroku ê³„ì •ì„ ì¸ì¦(Verify)í•´ì•¼ ì•±ì„ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.**  

---

## **ğŸ“Œ 1. Heroku ê³„ì • ì¸ì¦ (Verify Account)**
HerokuëŠ” **ë¬´ë£Œ í”Œëœ(Freemium) ê³„ì •ì´ì§€ë§Œ ì‹ ìš©ì¹´ë“œ ì •ë³´ë¥¼ ì…ë ¥í•´ì•¼ ë¬´ë£Œ ê³„ì •ì´ í™œì„±í™”ë©ë‹ˆë‹¤.**  
ğŸ’¡ **ì°¸ê³ :** ì‹ ìš©ì¹´ë“œ ë“±ë¡ í›„ **ë¬´ë£Œ í”Œëœ(Spark Plan)ì—ì„œ ê³„ì† ë¬´ë£Œë¡œ ì‚¬ìš© ê°€ëŠ¥**í•˜ë©° ìë™ ê²°ì œê°€ ë°œìƒí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

### **âœ… 1-1. Heroku ê³„ì • ì¸ì¦ (Verification)**
1ï¸âƒ£ **[Heroku Dashboard](https://dashboard.heroku.com/)**ì— ë¡œê·¸ì¸  
2ï¸âƒ£ **ìš°ì¸¡ ìƒë‹¨ í”„ë¡œí•„ ì‚¬ì§„ í´ë¦­ â†’ Account Settings(ê³„ì • ì„¤ì •)**  
3ï¸âƒ£ **Billing(ê²°ì œ ì •ë³´) íƒ­ì—ì„œ "Add Credit Card" ì„ íƒ**  
4ï¸âƒ£ **ì‹ ìš©ì¹´ë“œ ì •ë³´ë¥¼ ì…ë ¥í•˜ê³  "Save" í´ë¦­í•˜ì—¬ ë“±ë¡**  
5ï¸âƒ£ **Heroku ê³„ì •ì´ ì¸ì¦ë˜ì—ˆëŠ”ì§€ í™•ì¸**  
   ```bash
   heroku account
   ```
   âœ… **"Verified"ë¼ê³  í‘œì‹œë˜ë©´ ê³„ì • ì¸ì¦ ì™„ë£Œ**

---

## **ğŸ“Œ 2. ì¸ì¦ í›„ Heroku ì•± ë‹¤ì‹œ ìƒì„±**
### **âœ… 2-1. Heroku ì•± ë‹¤ì‹œ ìƒì„±**
```bash
heroku create numerology-api
```
âœ… **ì´ì œ ì•±ì´ ì •ìƒì ìœ¼ë¡œ ìƒì„±ë  ê²ƒì…ë‹ˆë‹¤.**  
âœ… **ì´ì „ê³¼ ë™ì¼í•œ ë°©ë²•ìœ¼ë¡œ API ë°°í¬ ì§„í–‰ ê°€ëŠ¥**  

---

## **ğŸ“Œ 3. Heroku ëŒ€ì²´ ë°©ë²•: Firebase Functions ì‚¬ìš©**
Herokuê°€ ì•„ë‹Œ Firebase Functionsì„ í™œìš©í•˜ì—¬ **ì„œë²„ë¦¬ìŠ¤ APIë¥¼ êµ¬í˜„í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.**  
### **Firebase Functions ì¥ì **
âœ… **ë¬´ë£Œ Spark Planì—ì„œë„ ì‚¬ìš© ê°€ëŠ¥** (ì›” 200ë§Œ íšŒ í˜¸ì¶œ ë¬´ë£Œ)  
âœ… **Firestore ì—°ë™ì´ ì‰¬ì›€**  
âœ… **ì„œë²„ ìœ ì§€ ê´€ë¦¬ ë¶ˆí•„ìš” (ì„œë²„ë¦¬ìŠ¤)**  
âœ… **SwiftUI ì•±ê³¼ ì—°ë™í•˜ê¸° í¸ë¦¬**  

### **ğŸ“Œ Firebase Functionsìœ¼ë¡œ API ë§Œë“¤ê¸°**
1ï¸âƒ£ Firebase CLI ì„¤ì¹˜ í›„ ë¡œê·¸ì¸  
```bash
npm install -g firebase-tools
firebase login
```
2ï¸âƒ£ Firebase í”„ë¡œì íŠ¸ ì´ˆê¸°í™”  
```bash
firebase init functions
```
3ï¸âƒ£ `functions/index.js` íŒŒì¼ ìˆ˜ì • (ìš´ì„¸ ë¶„ì„ API)
```javascript
const functions = require("firebase-functions");

exports.numerology = functions.https.onRequest((req, res) => {
    const { name, birthdate } = req.query;
    if (!name || !birthdate) {
        return res.status(400).json({ error: "ì´ë¦„ê³¼ ìƒë…„ì›”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”." });
    }

    const luckyNumber = (name.length + birthdate.replace(/-/g, "").split("").reduce((a, b) => a + parseInt(b), 0)) % 9 + 1;
    res.json({ result: `${name}ë‹˜ì˜ í–‰ìš´ì˜ ìˆ«ìëŠ” ${luckyNumber}ì…ë‹ˆë‹¤.` });
});
```
4ï¸âƒ£ Firebase Functions ë°°í¬  
```bash
firebase deploy --only functions
```
5ï¸âƒ£ **Firebase API í˜¸ì¶œ URL í™•ì¸**  
- Firebase Console â†’ Functions â†’ API URL í™•ì¸  

6ï¸âƒ£ **SwiftUIì—ì„œ Firebase API í˜¸ì¶œ ê°€ëŠ¥**  
```swift
let urlString = "https://us-central1-yourproject.cloudfunctions.net/numerology?name=\(name)&birthdate=\(birthdate)"
```

---

## **ğŸ“Œ ê²°ë¡ : Heroku vs Firebase Functions**
| ë¹„êµ í•­ëª© | **Heroku** | **Firebase Functions** |
|-----------|----------|------------------|
| **ë¬´ë£Œ í”Œëœ** | ê³„ì • ì¸ì¦ í•„ìš” (ì¹´ë“œ ë“±ë¡) | ë¬´ë£Œ (200ë§Œ íšŒ í˜¸ì¶œ) |
| **ë°°í¬ ë°©ì‹** | Node.js Express ì„œë²„ | ì„œë²„ë¦¬ìŠ¤ Functions |
| **ì„œë²„ ìœ ì§€ ê´€ë¦¬** | í•„ìš” | ë¶ˆí•„ìš” |
| **Firestore ì—°ë™** | ì„¤ì • í•„ìš” | ë„¤ì´í‹°ë¸Œ ì§€ì› |

ğŸ”¥ **ì¶”ì²œ:**  
ğŸ‘‰ **Firebase Functionsì„ ì‚¬ìš©í•˜ë©´ Heroku ê³„ì • ì¸ì¦ ì—†ì´ ë¬´ë£Œë¡œ APIë¥¼ êµ¬ì¶•í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.**  
ğŸ‘‰ **Firestoreì™€ì˜ ì—°ë™ì´ í•„ìš”í•˜ë‹¤ë©´ Firebase Functionsì´ ë” ìœ ë¦¬í•©ë‹ˆë‹¤.**  

ğŸš€ **ì–´ë–¤ ë°©ì‹ìœ¼ë¡œ ì§„í–‰í• ê¹Œìš”?** Heroku ê³„ì • ì¸ì¦ì„ ì§„í–‰í•˜ì‹œê² ìŠµë‹ˆê¹Œ, ì•„ë‹ˆë©´ Firebase Functionsì„ ì‚¬ìš©í• ê¹Œìš”? ğŸ˜Š